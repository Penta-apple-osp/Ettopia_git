<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reviewList.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/reviewRegister.css') }}">
    <script src="{{ url_for('static', filename='main.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/storeRegister.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/reviewRegister.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/imgUploadDelete.js') }}" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>
<body>
    <!--í—¤ë” ì˜ì—­-->
    {% include 'header.html' %}
    
    {% with mesg = get_flashed_messages() %}
    {% if mesg !=[] %}
    <script>alert("{{ mesg[0] }}")</script>
    {% endif %}
    {% endwith %}

    <!--íƒ€ì´í‹€ ì˜ì—­-->
    <div class="wrap_txt">
        <p class="title_review">ë¦¬ë·° ë¦¬ìŠ¤íŠ¸</p>
        <p class="desc_review">ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ë¦¬ë·°ë¥¼ ì½ì–´ë³´ì„¸ìš”!</p>
    </div>

    <!--ê°€ê²Œë¡œ ëŒì•„ê°€ê¸°~ë©”ë‰´ì¶”ê°€ ì˜ì—­-->
    <div class="wrap_btn">
        <a href="/storeDetail/{{category}}/{{store_name}}/" class="btn_return_store">
            <img class="img_return_store" src="{{ url_for('static', filename='icon/icon_return.png') }}" alt="ê°€ê²Œë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼">
            <div class="txt_btn">ê°€ê²Œë¡œ ëŒì•„ê°€ê¸°</div>
        </a>
        <a href="#a" class="btn_add_review">
            <div class="txt_btn">ë¦¬ë·° ì¶”ê°€</div>
            <img class="img_add_review" src="{{ url_for('static', filename='icon/icon_circle_add.png') }}" alt="ë©”ë‰´ ë“±ë¡ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ê¸° ë²„íŠ¼">
        </a>
    </div>

    <!--ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ì˜ì—­-->
    <div class="wrap_review_list">
        {% if total > 0 %}
        {% for data in datas %}
        <div class="wrap_reviewblock">
            <div class="wrap_review_area">
                <div class="wrap_profile">
                    <img class="img_profile" src="{{data.profile_pic}}">
                </div>
                <div class="txt_area">
                    <div class="title_area">
                        <div class="info_nickname">{{data.reviewer_nickname}}</div>
                        <div class="wrap_star">
                            <i data-star="{{data.rating}}"></i>
                    </div>
                    </div>
                    <p class="txt_review">
                        {{data.review_txt}}
                    </p>
                    <div class="wrap_img_review">
                        <img class="img_review" src="{{data.img_path}}" alt="ê°€ê²Œ ëŒ€í‘œì‚¬ì§„">
                        <!-- ì¼ë‹¨ ì‚¬ì§„ì€ í•˜ë‚˜ë§Œ ì˜¬ë¦´ ìˆ˜ ìˆë‹¤ê³  í•˜ì...
                        <img class="img_review" src="https://via.placeholder.com/200x144.png/ddd/ddd" alt="ê°€ê²Œ ëŒ€í‘œì‚¬ì§„">
                        -->
                    </div>
                </div>
                <div class="wrap_like">
                        <!--
                        <input type="checkbox" id="liked" class="liked" name="liked" value="liked" /><label for="liked"></label>
                        -->
                    <p class="liked" id="" name="liked" value="{{data.key}}" onclick='change_like_color(this)'>â¤</p>
                    <p class="txt_num_like" id="">{{data.like_num}}</p>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="wrap_none_review">
            <img src="{{ url_for('static', filename='icon/icon_crying.png') }}" height="50" width="50" alt="crying">
            <p style="font-family: 'Noto Sans KR', sans-serif;font-weight: 700; font-size: 17px; color: var(--common-dark-grey)">
            ì•„ì§ {{store_name}}ì— ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ì–´ìš”. ì²« ë¦¬ë·°ë¥¼ ë“±ë¡í•´ ì£¼ì„¸ìš”!
            </p>
        </div>
        {% endif %}
        
        <!--ì˜ˆì‹œë¡œ ë‚¨ê²¨ë‘ê¸°
        <div class="wrap_reviewblock">
            <div class="wrap_review_area">
                <div class="wrap_profile">
                    <img class="img_profile" src="https://via.placeholder.com/100x100.png/ddd/ddd">
                </div>
                <div class="txt_area">
                    <div class="title_area">
                        <div class="info_nickname">ë‹‰ë„¤ì„</div>
                        <img src="{{ url_for('static', filename='icon/icon_rating.png') }}" alt="í‰ì " width="20" height="20">
                        <img src="{{ url_for('static', filename='icon/icon_rating.png') }}" alt="í‰ì " width="20" height="20">
                        <img src="{{ url_for('static', filename='icon/icon_rating.png') }}" alt="í‰ì " width="20" height="20">
                        <img src="{{ url_for('static', filename='icon/icon_rating.png') }}" alt="í‰ì " width="20" height="20">
                        <img src="{{ url_for('static', filename='icon/icon_rating.png') }}" alt="í‰ì " width="20" height="20">
                    </div>
                    <p class="txt_review">ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. 
                        ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. 
                        ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. 
                        ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤.
                        ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. 
                        ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤. ë¦¬ë·° ë‚´ìš©ì„ ì—¬ê¸°ì— ë‹´ìŠµë‹ˆë‹¤.
                    </p>
                    <img class="img_review" src="https://via.placeholder.com/200x144.png/ddd/ddd" alt="ê°€ê²Œ ëŒ€í‘œì‚¬ì§„">
                </div>
                <div class="wrap_like">
                    <img class="img_like" src="{{ url_for('static', filename='icon/icon_like_before.png') }}">
                    <p class="txt_num_like">10</p>
                </div>
            </div>
        </div>
        -->
    </div>

    <!--ë¦¬ë·° ì¶”ê°€ íŒì—…ì°½-->
    {% include 'reviewRegisterSubmit.html' %}

    <div class="dummy_page"></div>
    <!--í‘¸í„° ì˜ì—­-->
    {% include 'footer.html' %}
    
    <script>
    let review_dic = {
	    "reviewKey" : null,
        "elementId" : null
	};
        
    let like_dic = {
	    "reviewKey" : null,
        "elementId" : null
	};
        
        <!--ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ëˆ„ë¥¸ Likeë¥¼ ë³´ì—¬ì£¼ëŠ” ajax-->
    $(document).ready(function(){
       for(var i=0; i < $(".liked").length; i++){
            $(".liked").eq(i).attr("id", "heart" + i); 
            $(".txt_num_like").eq(i).attr("id", "like_num" + i);
            like_dic['reviewKey'] = $(".liked").eq(i).attr("value");
            like_dic['elementId'] =  $(".liked").eq(i).attr('id');
            //console.log(like_dic['reviewKey']);
            //console.log(like_dic['elementId']);
           
            $.ajax({
              type : 'post',
              url: '{{url_for("checkLike")}}',
              data : JSON.stringify(like_dic),
              dataType : 'JSON',
              contentType: "application/json",
              success : function(data) { //dataëŠ” ë‚´ê°€ flaskì—ì„œ return ë°›ì€ ë°ì´í„° ì´ë¦„
                //console.log(data['elementId']);
                if (data['result'] == 'success'){
                    $("#" + data['elementId']).addClass('clicked');
                }
              },
              error : function() {
                alert('ì„œë²„ í†µì‹ ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
              }
            })
           
        }
    });
        
    //likeì˜ ìƒ‰ì„ ë°”ê¾¸ì–´ì£¼ëŠ” í•¨ìˆ˜->í´ë¦­ ì‹œ í•‘í¬, í´ë¦­ ì·¨ì†Œì‹œ íšŒìƒ‰
    function change_like_color(element) {
        if($(element).hasClass('clicked')){ //ì´ë¯¸ í´ë¦­ ëœ ìƒí™©ì´ë‹ˆê¹Œ ì‚­ì œí•´ ì£¼ì–´ì•¼ í•¨
            review_dic['reviewKey'] = $(element).attr('value');
            review_dic['elementId'] = $(element).next().attr('id');
            //console.log(review_dic);
            
            $.ajax({
              type : 'post',
              url: '{{url_for("sub")}}',
              data : JSON.stringify(review_dic),
              dataType : 'JSON',
              contentType: "application/json",
              success : function(data) { //dataëŠ” ë‚´ê°€ flaskì—ì„œ return ë°›ì€ ë°ì´í„° ì´ë¦„
                if (data['result'] == 'success'){
                    //console.log(data['elementId']);
                    $(element).toggleClass('clicked');
                    $("#" + data['elementId']).text(data['like_num']);
                }
                if (data['result'] == 'notauser'){
                    alert('ğŸªì¢‹ì•„ìš” ê¸°ëŠ¥ì€ ì´ë˜í”¼ì•„ì˜ ê±°ì£¼ë¯¼ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”ğŸª');
                } 
              },
              error : function() {
                alert('ì„œë²„ í†µì‹ ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
              }
            })
            
        } else{ //í´ë¦­ì´ ì•ˆ ëœ ìƒí™©ì´ë‹ˆê¹Œ í´ë¦­ìœ¼ë¡œ ë°”ê¾¸ì–´ ì£¼ì–´ì•¼ í•¨
            //console.log($(element).attr('value'));
            review_dic['reviewKey'] = $(element).attr('value');
            review_dic['elementId'] = $(element).next().attr('id');
            //console.log(review_dic);
            
            $.ajax({
              type : 'post',
              url: '{{url_for("add")}}',
              data : JSON.stringify(review_dic),
              dataType : 'JSON',
              contentType: "application/json",
              success : function(data) { //dataëŠ” ë‚´ê°€ flaskì—ì„œ return ë°›ì€ ë°ì´í„° ì´ë¦„
                if (data['result'] == 'success'){
                    //console.log(data['elementId']);
                    $(element).toggleClass('clicked');
                    $("#" + data['elementId']).text(data['like_num']);
                }
                if (data['result'] == 'notauser'){
                    alert('ğŸªì¢‹ì•„ìš” ê¸°ëŠ¥ì€ ì´ë˜í”¼ì•„ì˜ ê±°ì£¼ë¯¼ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”ğŸª');
                }     
              },
              error : function() {
                alert('ì„œë²„ í†µì‹ ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
              }
            }) //ajaxì˜ ê´„í˜¸ì…ë‹ˆë‹¤
        } //elseì˜ ê´„í˜¸ì…ë‹ˆë‹¤
    } //í•¨ìˆ˜ì˜ ê´„í˜¸ì…ë‹ˆë‹¤
        
    
    </script>
    
</body>
</html>